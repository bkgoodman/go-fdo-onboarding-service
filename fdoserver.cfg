# FDO Full Server Configuration Example
# This configuration file demonstrates all available options for the merged
# DI + Full FDO server that replaces the original manufacturing station

# Basic settings
debug: false
fdo_version: 200  # 101 or 200

# Server settings
server:
  addr: "localhost:8080"        # Address to listen on
  ext_addr: "localhost:8080"     # External address devices should connect to
  use_tls: false                 # Enable TLS (not fully implemented)
  insecure_tls: false            # Use self-signed TLS certificate

# Database settings
database:
  path: "manufacturing.db"       # SQLite database file path
  password: ""                   # Database encryption-at-rest passphrase

# Manufacturing settings (DI functionality)
manufacturing:
  device_ca_key_type: "ec384"    # Device CA key type
  owner_key_type: "ec384"        # Owner key type  
  generate_certificates: true    # Generate certificates for keys
  first_time_init: false         # Force key generation on first run

# Owner configuration (from server.go)
owner:
  generate_certificates: false    # Generate owner certificates in addition to keys

# Rendezvous configuration (where devices find the owner service)
rendezvous:
  entries:
    # Primary owner service
    - host: "127.0.0.1"
      port: 8080
      scheme: "http"
    # Backup owner service (example)
    # - host: "backup-owner.example.com"
    #   port: 443
    #   scheme: "https"

# TO0 (Rendezvous) configuration
to0:
  addr: ""                       # Rendezvous server address (disables self-registration)
  guid: ""                       # Device GUID to immediately register an RV blob
  delegate: ""                   # Use delegate cert (name) for RV blob signing
  bypass: false                  # Skip TO1
  delay: 0                       # Delay TO1 by N seconds
  replacement_policy: "allow-any"  # RV voucher replacement policy

# Resale configuration
resale:
  guid: ""                       # Voucher GUID to extend for resale
  key: ""                        # Path to PEM-encoded x.509 public key for next owner

# FSIM (FDO Service Information Modules) configuration
fsim:
  # File downloads to devices
  downloads:
    # - "config.txt"
    # - "software.bin"
  
  # File uploads from devices  
  upload_dir: "uploads"          # Directory to put file uploads
  uploads:
    # - "device.log"
    # - "diagnostic.txt"
  
  # Remote file fetching (wget)
  wgets:
    # - "https://example.com/config.json"
    # - "https://example.com/data.bin"
  
  # System configuration parameters
  sysconfig:
    # - "hostname=manufacturing-device"
    # - "timezone=UTC"
    # - "ntp-server=pool.ntp.org"
  
  # Payload transfer (single file)
  payload_file: ""               # Path to single payload file
  payload_mime: "application/octet-stream"  # MIME type for payload file
  
  # Payload transfer (multiple files with types)
  payload_files:
    # - "application/json:config.json"
    # - "text/x-shellscript:setup.sh"
    # - "application/octet-stream:firmware.bin"
  
  # Boot Media Object (BMO) transfer (single file)
  bmo_file: ""                   # Path to single BMO file
  bmo_image_type: "application/x-iso9660-image"  # Image type for BMO file
  
  # BMO transfer (multiple files with types)
  bmo_files:
    # - "application/x-iso9660-image:os.iso"
    # - "application/octet-stream:bootloader.bin"
  
  # WiFi configuration
  wifi_config_file: ""           # Path to WiFi configuration JSON file
  
  # Credential provisioning
  credentials:
    # Format: type:id:data[:endpoint_url]
    # Types: password, api_key, oauth2_client_secret, bearer_token
    # - "password:admin:admin123"
    # - "api_key:service1:abc123def456:https://api.example.com"
  
  # Public key requests from devices
  pubkey_requests:
    # Format: type:id[:endpoint_url]
    # - "ssh-rsa:admin"
    # - "ssh-rsa:backup:https://keys.example.com"
  
  # Command execution on device
  command_date: false            # Use fdo.command FSIM to run "date +%s"
  
  # Single-sided WiFi setup
  single_sided_wifi: false       # Run as single-sided WiFi setup service

# Delegate configuration
delegate:
  rv: ""                         # Use delegate cert for RV blob signing
  onboard: ""                    # Use delegate cert for TO2

# Import/Export configuration
import:
  voucher: ""                    # Import PEM encoded voucher file path

# Print/export configuration
print:
  owner_public: ""               # Print owner public key of type and exit
  owner_private: ""              # Print owner private key of type and exit  
  owner_chain: ""                # Print owner chain of type and exit

# Voucher management configuration
voucher_management:
  persist_to_db: true             # Store vouchers in database
  
  # Voucher signing configuration
  voucher_signing:
    mode: "internal"              # "internal" or "external"
    owner_key_type: "ec384"       # Owner key type for internal mode
    first_time_init: true         # Create key on first boot for internal mode
    external_command: ""          # Command for external mode
    external_timeout: 30s         # Timeout for external command
    manufacturer_public_key_file: ""  # PEM file with manufacturer public key
  
  # Owner signover configuration  
  owner_signover:
    mode: "static"                # "static" or "dynamic"
    static_public_key: ""         # PEM-encoded public key for static mode
    external_command: ""          # Command for dynamic mode
    timeout: 10s                  # Timeout for dynamic mode
  
  # Voucher upload configuration
  voucher_upload:
    enabled: false                # Enable voucher upload
    external_command: ""          # Upload command
    timeout: 30s                  # Upload timeout
  
  # OVE Extra data configuration
  ove_extra_data:
    enabled: false                # Enable OVE extra data
    external_command: ""          # Command for extra data
    timeout: 30s                  # Timeout for extra data
  
  # Save vouchers to disk
  save_to_disk:
    directory: ""                 # Directory to save vouchers (empty = disabled)
